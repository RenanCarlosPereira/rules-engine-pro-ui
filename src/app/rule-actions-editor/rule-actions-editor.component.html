<h2 class="text-lg font-semibold mb-4">Edit Actions</h2>

<button (click)="onClose()"
  class="absolute top-3 right-4 text-gray-500 hover:text-red-600 text-xl font-bold">&times;</button>

<!-- OnSuccess Action -->
<div class="mb-6">
  <div *ngIf="rule.Actions?.OnSuccess; else addOnSuccess">
    <label class="text-sm text-gray-600">OnSuccess Name:</label>
    <div class="flex items-center gap-2 mt-1">
      <input class="border p-1 text-sm rounded w-1/2" placeholder="Success action name"
        [value]="rule.Actions?.OnSuccess?.Name" (input)="updateActionName('OnSuccess', $any($event.target).value)" />
      <button (click)="removeAction('OnSuccess')">
        <i-lucide [img]="Trash2" class="w-4 h-4 text-red-600" />
      </button>
    </div>

    <div class="mt-2">
      <h5 class="text-xs text-gray-500 mb-1">Context</h5>
      <div *ngFor="let key of getContextKeys('OnSuccess'); let i = index" class="flex gap-2 mb-2">
        <input class="border p-1 text-xs rounded w-1/4" [value]="key"
          (blur)="onContextKeyBlur('OnSuccess', i, $any($event.target).value)" />
        <input class="border p-1 text-xs rounded w-2/4" [value]="rule.Actions?.OnSuccess?.Context![key]"
          (input)="updateContextValue('OnSuccess', key, $any($event.target).value)" />
        <button (click)="deleteContextEntry('OnSuccess', key)">
          <i-lucide [img]="Trash2" class="w-4 h-4 text-red-500" />
        </button>
      </div>
      <button (click)="addContextEntry('OnSuccess')"
        class="text-xs flex items-center gap-1 text-blue-600 text-sm mt-2 hover:underline transition-transform hover:scale-105">
        <i-lucide [img]="Plus" class="w-4 h-4" /> Add context entry
      </button>
    </div>
  </div>
  <ng-template #addOnSuccess>
    <button (click)="addAction('OnSuccess')"
      class="flex items-center gap-1 text-blue-600 text-sm mt-2 hover:underline transition-transform hover:scale-105">
      <i-lucide [img]="Plus" class="w-4 h-4" /> Add OnSuccess Action
    </button>
  </ng-template>
</div>

<!-- OnFailure Action -->
<div>
  <div *ngIf="rule.Actions?.OnFailure; else addOnFailure">
    <label class="text-sm text-gray-600">OnFailure Name:</label>
    <div class="flex items-center gap-2 mt-1">
      <input class="border p-1 text-sm rounded w-1/2" placeholder="Failure action name"
        [value]="rule.Actions?.OnFailure?.Name" (input)="updateActionName('OnFailure', $any($event.target).value)" />
      <button (click)="removeAction('OnFailure')">
        <i-lucide [img]="Trash2" class="w-4 h-4 text-red-600" />
      </button>
    </div>

    <div class="mt-2">
      <h5 class="text-xs text-gray-500 mb-1">Context</h5>
      <div *ngFor="let key of getContextKeys('OnFailure'); let i = index" class="flex gap-2 mb-2">
        <input class="border p-1 text-xs rounded w-1/4" [value]="key"
          (blur)="onContextKeyBlur('OnFailure', i, $any($event.target).value)" />
        <input class="border p-1 text-xs rounded w-2/4" [value]="rule.Actions!.OnFailure!.Context![key]"
          (input)="updateContextValue('OnFailure', key, $any($event.target).value)" />
        <button (click)="deleteContextEntry('OnFailure', key)">
          <i-lucide [img]="Trash2" class="w-4 h-4 text-red-500" />
        </button>
      </div>
      <button (click)="addContextEntry('OnFailure')"
        class="text-xs flex items-center gap-1 text-blue-600 text-sm mt-2 hover:underline transition-transform hover:scale-105">
        <i-lucide [img]="Plus" class="w-4 h-4" /> Add context entry
      </button>
    </div>
  </div>
  <ng-template #addOnFailure>
    <button (click)="addAction('OnFailure')"
      class="flex items-center gap-1 text-blue-600 text-sm mt-2 hover:underline transition-transform hover:scale-105">
      <i-lucide [img]="Plus" class="w-4 h-4" /> Add OnFailure Action
    </button>
  </ng-template>
</div>
